{% extends "base.html" %} 
{% block title %} | Welcome {% endblock %} 

{% block content %}
<!-- Showcase -->

<div class="container">
  <!-- Alerts -->
  {% include 'partials/_alerts.html' %}
  <div id="movie" class="well"></div>
</div>

<section id="reviews" class="py-5">
  <div class="container">
    <h3 class="mb-3">Reviews</h3>
    <hr>
    <div class="container">
      {% if reviews %} {% for review in reviews %}
      <div class="row">
        <div class="col-md-12" style="display: inline-flex;">
          <h4>{{ review.review_title }}</h4> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <em>{{ review.username }} | {{ review.review_date | timesince }} ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{ review.rating }} / 5</em>
        </div>
        <br />
        <div class="col-12">{{ review.review_content }}</div>
      </div>
      <br />
      <hr>
      {% endfor %} {% else %}
      <div class="col-md-12">
        <p>No Reviews Yet.</p>
      </div>
      {% endif %}
    </div>
    <div class="row">
      <div class="col-md-12">
        <br>
        <form action="{% url 'review' %}" method="POST">
          {% csrf_token %} {% if user.is_authenticated %}
          <p>Leave a Review:</p>
          <input type="hidden" name="user_id" value="{{ user.id }}" />
          <input type="hidden" name="username" value="{{ user.username }}" />
          
          <input type="hidden" name="media_id" id="media_id"/>
          <input type="hidden" name="media_title" id="media_title" />

          <div class="form-group">
            <label for="review_title">Title: </label>
            <input type="text" name="review_title" class="form-control" />
          </div>

          <div class="form-group">
            <label for="review_content">Review: </label>
            <textarea name="review_content" class="form-control"></textarea>
          </div>

          <div class="form-group">
            <select name="rating" class="form-control" id="type">
              <option selected="true" disabled="disabled">
                Rating
              </option>
              {% for key,value in rating_choices.items %}
              <option value="{{ key }}">{{ value }}</option>
              {% endfor %}
            </select>
          </div>

          <input
            type="submit"
            value="Post Review"
            class="btn btn-block btn-secondary"
          />
          {% else %}
        <p>Login to leave a review.</p>
        {% endif %}
        </form>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">
  let movieType = localStorage.getItem('type');
  let title = localStorage.getItem('title');
  let titleId = sessionStorage.getItem('movieId');
  document.getElementById("media_id").value = titleId;
  document.getElementById("media_title").value = title;
  if (movieType == 'person') {
    document.getElementById('reviews').innerHTML = "";
  }
</script>
{% endblock %}
