{% extends "base.html" %} 
{% block title %} | Welcome {% endblock %} 

{% block content %}
<!-- Showcase -->

<div class="container">
  <!-- Alerts -->
  {% include 'partials/_alerts.html' %}
  <div id="movie" class="well"></div>
  <div class="col-md-2" id="likeBtn">
    {% if is_liked %}
    <form action="{% url 'unlike' %}" method="POST">
      {% csrf_token %} {% if user.is_authenticated %}
      <input type="hidden" name="user_id" value="{{ user.id }}" />
      <input type="hidden" name="media_id" id="media_id"/>
      <input type="hidden" name="media_title" id="media_title" />
      <input type="hidden" name="media_type" id="media_type" />
      <input type="hidden" name="media_poster" id="media_poster" />
      <input type="hidden" name="username" value="{{ user.username }}" />
  
      <input
        type="submit"
        value="Unlike Title"
        class="btn btn-block btn-info"
        style="margin-top: -7px;"
      />
      {% endif %}
    </form>
    {% else %}
    <form action="{% url 'favourite' %}" method="POST">
      {% csrf_token %} {% if user.is_authenticated %}
      <input type="hidden" name="user_id" value="{{ user.id }}" />
      <input type="hidden" name="media_id" id="media_id"/>
      <input type="hidden" name="media_title" id="media_title" />
      <input type="hidden" name="media_type" id="media_type" />
      <input type="hidden" name="media_poster" id="media_poster" />
      <input type="hidden" name="username" value="{{ user.username }}" />
  
      <input
        type="submit"
        value="Like Title"
        class="btn btn-block btn-info"
        style="margin-top: -7px;"
      />
      {% endif %}
    </form>
    {% endif %}
  </div>
</div>

<section id="reviews" class="py-5">
  <div class="container">
    <h3 class="mb-3">Reviews</h3>
    <hr>
    <div class="container">
      {% if reviews %} {% for review in reviews %}
      <div class="row">
          <img
              class="reviewPic"
              src="{{ review.user_image_url }}"
              alt=""
            />
        <div class="col-md-10">
          <div class="row">
            <div class="col-md-12" style="display: inline-flex;">
              {% if review.user_id == user.id %}
              <h4>{{ review.review_title }}</h4> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <em><a href="{% url 'account' %}">{{ review.username }}</a> | {{ review.review_date | timesince }} ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{ review.rating }} / 5</em>
              {% else %}
              <h4>{{ review.review_title }}</h4> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <em><a href="{% url 'profile' review.user_id %}">{{ review.username }}</a> | {{ review.review_date | timesince }} ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{ review.rating }} / 5</em>
              {% endif %}
            </div>
            <br />
            <div class="col-12">{{ review.review_content }}</div>
          </div>
        </div>
      </div>
      <br />
      <hr>
      {% endfor %} {% else %}
      <div class="col-md-12">
        <p>No Reviews Yet.</p>
      </div>
      {% endif %}
    </div>
    <div class="row">
      <div class="col-md-12">
        <br>
        <form action="{% url 'review' %}" method="POST">
          {% csrf_token %} {% if user.is_authenticated %}
          <p>Leave a Review:</p>
          <input type="hidden" name="user_id" value="{{ user.id }}" />
          <input type="hidden" name="username" value="{{ user.username }}" />
          <input type="hidden" name="user_image_url" value="{{ user.profile.image.url }}" />
          
          <input type="hidden" name="media_id" id="media_id_review" />
          <input type="hidden" name="media_title" id="media_title_review" />
          <input type="hidden" name="media_type" id="media_type_review" />
          <input type="hidden" name="media_poster" id="media_poster_review" />

          <div class="form-group">
            <label for="review_title">Title: </label>
            <input type="text" name="review_title" class="form-control" autocomplete="off" />
          </div>

          <div class="form-group">
            <label for="review_content">Review: </label>
            <textarea name="review_content" class="form-control" autocomplete="off"></textarea>
          </div>

          <div class="form-group">
            <select name="rating" class="form-control" id="type">
              <option selected="true" disabled="disabled">
                Rating
              </option>
              {% for key,value in rating_choices.items %}
              <option value="{{ key }}">{{ value }}</option>
              {% endfor %}
            </select>
          </div>

          <input
            type="submit"
            value="Post Review"
            class="btn btn-block btn-secondary"
          />
          {% else %}
        <p>Login to leave a review.</p>
        {% endif %}
        </form>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">
  let movieType = localStorage.getItem('type');
  let title = localStorage.getItem('title');
  let titleId = localStorage.getItem('movieId');
  let titlePoster = localStorage.getItem('poster');
  document.getElementById("media_id").value = titleId;
  document.getElementById("media_title").value = title;
  document.getElementById("media_type").value = movieType;
  document.getElementById("media_poster").value = titlePoster;
  document.getElementById("media_id_review").value = titleId;
  document.getElementById("media_title_review").value = title;
  document.getElementById("media_type_review").value = movieType;
  document.getElementById("media_poster_review").value = titlePoster;
  if (movieType == 'person') {
    document.getElementById('reviews').innerHTML = "";
    document.getElementById('likeBtn').innerHTML = "";
  }
</script>
{% endblock %}
